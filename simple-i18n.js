// Simplified I18n system for LinearityFX
window.LinearityI18n = {
    currentLang: 'it',
    
    translations: {
        it: {
            // Navigation
            'nav.home': 'Home',
            'nav.about': 'Il Progetto', 
            'nav.guide': 'Guida',
            'nav.results': 'Risultati',
            'nav.contact': 'Contatti',

            // Hero section
            'hero.title': 'LINEARITY',
            'hero.description': 'Strategia ideata, strutturata e gestita interamente dal Team di LinearityFX!<br><br>Il sistema, attraverso dei complessi e rigorosi calcoli algoritmici, effettua operazioni intraday su XAU/USD cercando di massimizzare il profitto per il cliente non tralasciando l\'importantissimo aspetto del Money Management.<br><br>Correlato da un potente e sempre aggiornato sistema di controllo delle news, opera sempre a riparo da possibili condizionamenti estremi ed improvvisi del mercato.<br><br><strong>Continua a leggere il sito per sapere come aderire al sistema, replicarne le operazioni gratuitamente in totale autonomia senza l\'utilizzo di strumenti complicati e sfruttare le sue enormi potenzialità!</strong>',
            'hero.telegram_btn': 'Unisciti su Telegram',
            'hero.learn_more': 'Scopri di più',

            // About section
            'about.title': 'Il Progetto Linearity',
            'about.description': 'Un approccio sistematico e professionale al trading che combina tecnologia avanzata, sicurezza e libertà finanziaria per offrire ai nostri clienti un\'esperienza di investimento completamente trasparente e automatizzata.',
            'about.card1.title': 'Strategie Avanzate',
            'about.card1.description': 'Utilizziamo analisi tecnica e algoritmi proprietari per identificare le migliori opportunità di trading sui mercati finanziari. Il sistema utilizza un innovativo Take Profit mobile in modo da cavalcare l\'onda positiva della posizione aperta e massimizzare il profitto.',
            'about.card2.title': 'Filtro News Intelligente',
            'about.card2.description': 'Sempre vigile alle news globali, il sistema sospende l\'attività nel caso di news globali che possono condizionare negativamente l\'attività di trading attivandolo nuovamente al termine degli eventi sensibili.',
            'about.card3.title': 'Automatico',
            'about.card3.description': 'Il tuo conto replicherà esattamente i movimenti del conto principale senza che tu debba fare nulla. Non dovrai seguire mercati, analizzare grafici o preoccuparti di niente: tutto avviene automaticamente.',
            'about.card4.title': 'Sicuro',
            'about.card4.description': 'Collaboriamo esclusivamente con broker certificati e autorizzati dalle principali autorità finanziarie, garantendo la massima sicurezza per i tuoi investimenti. I fondi rimangono sempre nella tua piena disponibilità. Puoi prelevare i tuoi soldi quando vuoi.',
            'about.card5.title': 'Gratuito',
            'about.card5.description': 'Non pagherai mai alcuna quota associativa, il sistema cederà una piccola parte del profitto settimanale al team LinearityFX, se quella settimana non ti faremo guadagnare la tua commissione verrà azzerata.',
            'about.card6.title': 'Trasparenza Completa',
            'about.card6.description': 'Accesso in tempo reale a tutti i movimenti, statistiche dettagliate e performance del sistema. Nessun segreto, tutto sotto i tuoi occhi con 10 anni di track record verificabile.',

            // Guide section
            'guide.title': 'Guida alla Connessione',
            'guide.description': 'Tutto quello che devi sapere per iniziare il tuo percorso con LinearityFX',
            'guide.step1.title': 'Leggi l\'Introduzione',
            'guide.step1.description': 'Scarica e leggi il PDF introduttivo per comprendere il progetto LinearityFX',
            'guide.step2.title': 'Segui la Guida',
            'guide.step2.description': 'Utilizza la guida passo-passo per configurare correttamente il tuo account',
            'guide.step3.title': 'Unisciti su Telegram',
            'guide.step3.description': 'Entra nel gruppo ufficiale per supporto e aggiornamenti in tempo reale',
            'guide.intro.title': 'Presentazione di LinearityFX',
            'guide.intro.description': 'Scopri il mondo di LinearityFX, come funziona il sistema, le strategie utilizzate, i punti di forza e le potenzialità del progetto.',
            'guide.intro.button': 'Introduzione',
            'guide.manual.title': 'Guida alla Connessione',
            'guide.manual.description': 'Istruzioni alla creazione del conto presso il broker, configurazione account, connessione al sistema di LinearityFX.',
            'guide.manual.button': 'Guida',
            'guide.support.title': 'Hai Bisogno di Aiuto?',
            'guide.support.description': 'Se incontri difficoltà durante le fasi di connessione o hai ulteriori domande, il nostro team di supporto è disponibile su Telegram per assisterti.',
            'guide.support.telegram': 'Supporto Telegram',
            'guide.support.contact': 'Contattaci',

            // Results section
            'results.title': 'I Nostri Risultati',
            'results.description': 'I risultati mostrati sono verificati da MyFXBook e rappresentano performance reali dei nostri conti di trading.',
            'results.footer': 'Ecco risultati conseguiti dal sistema LinearityFX applicato ai dati storici del mercato.',
            'results.backtest1': 'Backtest<br>da 1 Gennaio 2020 al 1 Agosto 2025',
            'results.backtest2': 'Backtest<br>da 1 Gennaio 2015 al 1 Agosto 2025',
            'results.coming_soon': 'Disponibile a breve',

            // Contact section
            'contact.title': 'Contattaci',
            'contact.description': 'Hai domande? Siamo qui per aiutarti',
            'contact.telegram.title': 'Telegram',
            'contact.telegram.description': 'Il modo più veloce per contattarci',
            'contact.telegram.link': 'Vai al gruppo',
            'contact.instagram.title': 'Instagram',
            'contact.instagram.description': 'Seguici per aggiornamenti e contenuti',
            'contact.tiktok.title': 'TikTok',
            'contact.tiktok.description': 'Seguici per contenuti esclusivi',
            'contact.form.name': 'Nome',
            'contact.form.email': 'Email',
            'contact.form.message': 'Messaggio',
            'contact.form.submit': 'Invia Messaggio',

            // Footer
            'footer.copyright': '© 2025 Linearity. Tutti i diritti riservati.',
            'footer.risk_title': 'Avviso di Rischio:',
            'footer.risk_text': 'Il trading su Forex comporta un alto livello di rischio e può non essere adatto a tutti gli investitori. Prima di decidere di investire nel mercato dei cambi, dovresti considerare attentamente i tuoi obiettivi di investimento, il livello di esperienza e la propensione al rischio. Esiste la possibilità che tu possa sostenere una perdita di parte o tutto il tuo investimento iniziale e quindi non dovresti investire denaro che non puoi permetterti di perdere. Dovresti essere consapevole di tutti i rischi associati al trading su valute estere e chiedere consigli a un consulente finanziario indipendente in caso di dubbi. Le performance passate non sono indicative di risultati futuri.'
        },

        en: {
            // Navigation
            'nav.home': 'Home',
            'nav.about': 'The Project',
            'nav.guide': 'Guide',
            'nav.results': 'Results',
            'nav.contact': 'Contact',

            // Hero section
            'hero.title': 'LINEARITY',
            'hero.description': 'Strategy conceived, structured and managed entirely by the LinearityFX Team!<br><br>The system, through complex and rigorous algorithmic calculations, performs intraday operations on XAU/USD seeking to maximize profit for the client without neglecting the very important aspect of Money Management.<br><br>Correlated with a powerful and always updated news control system, it always operates sheltered from possible extreme and sudden market conditioning.<br><br><strong>Continue reading the site to learn how to join the system, replicate operations for free in complete autonomy without using complicated tools and exploit its enormous potential!</strong>',
            'hero.telegram_btn': 'Join on Telegram',
            'hero.learn_more': 'Learn More',

            // About section
            'about.title': 'The Linearity Project',
            'about.description': 'A systematic and professional approach to trading that combines advanced technology, security and financial freedom to offer our clients a completely transparent and automated investment experience.',
            'about.card1.title': 'Advanced Strategies',
            'about.card1.description': 'We use technical analysis and proprietary algorithms to identify the best trading opportunities in financial markets. The system uses an innovative mobile Take Profit to ride the positive wave of the open position and maximize profit.',
            'about.card2.title': 'Intelligent News Filter',
            'about.card2.description': 'Always vigilant to global news, the system suspends activity in case of global news that can negatively affect trading activity, reactivating it at the end of sensitive events.',
            'about.card3.title': 'Automated',
            'about.card3.description': 'Your account will replicate exactly the movements of the main account without you having to do anything. You won\'t have to follow markets, analyze charts or worry about anything: everything happens automatically.',
            'about.card4.title': 'Secure',
            'about.card4.description': 'We collaborate exclusively with certified and authorized brokers by the main financial authorities, guaranteeing maximum security for your investments. Funds always remain at your full disposal. You can withdraw your money whenever you want.',
            'about.card5.title': 'Free',
            'about.card5.description': 'You will never pay any membership fee, the system will give a small part of the weekly profit to the LinearityFX team, if that week we don\'t make you earn, your commission will be reset.',
            'about.card6.title': 'Complete Transparency',
            'about.card6.description': 'Real-time access to all movements, detailed statistics and system performance. No secrets, everything under your eyes with 10 years of verifiable track record.',

            // Guide section
            'guide.title': 'Connection Guide',
            'guide.description': 'Everything you need to know to start your journey with LinearityFX',
            'guide.step1.title': 'Read the Introduction',
            'guide.step1.description': 'Download and read the introductory PDF to understand the LinearityFX project',
            'guide.step2.title': 'Follow the Guide',
            'guide.step2.description': 'Use the step-by-step guide to properly configure your account',
            'guide.step3.title': 'Join on Telegram',
            'guide.step3.description': 'Enter the official group for support and real-time updates',
            'guide.intro.title': 'LinearityFX Presentation',
            'guide.intro.description': 'Discover the world of LinearityFX, how the system works, the strategies used, the strengths and potential of the project.',
            'guide.intro.button': 'Introduction',
            'guide.manual.title': 'Connection Guide',
            'guide.manual.description': 'Instructions for creating an account with the broker, account configuration, connection to the LinearityFX system.',
            'guide.manual.button': 'Guide',
            'guide.support.title': 'Need Help?',
            'guide.support.description': 'If you encounter difficulties during the connection phases or have additional questions, our support team is available on Telegram to assist you.',
            'guide.support.telegram': 'Telegram Support',
            'guide.support.contact': 'Contact Us',

            // Results section
            'results.title': 'Our Results',
            'results.description': 'The results shown are verified by MyFXBook and represent real performance of our trading accounts.',
            'results.footer': 'Here are the results achieved by the LinearityFX system applied to historical market data.',
            'results.backtest1': 'Backtest<br>from January 1, 2020 to August 1, 2025',
            'results.backtest2': 'Backtest<br>from January 1, 2015 to August 1, 2025',
            'results.coming_soon': 'Coming Soon',

            // Contact section
            'contact.title': 'Contact Us',
            'contact.description': 'Have questions? We\'re here to help',
            'contact.telegram.title': 'Telegram',
            'contact.telegram.description': 'The fastest way to contact us',
            'contact.telegram.link': 'Go to group',
            'contact.instagram.title': 'Instagram',
            'contact.instagram.description': 'Follow us for updates and content',
            'contact.tiktok.title': 'TikTok',
            'contact.tiktok.description': 'Follow us for exclusive content',
            'contact.form.name': 'Name',
            'contact.form.email': 'Email',
            'contact.form.message': 'Message',
            'contact.form.submit': 'Send Message',

            // Footer
            'footer.copyright': '© 2025 Linearity. All rights reserved.',
            'footer.risk_title': 'Risk Warning:',
            'footer.risk_text': 'Forex trading carries a high level of risk and may not be suitable for all investors. Before deciding to invest in the foreign exchange market, you should carefully consider your investment objectives, level of experience and risk appetite. There is a possibility that you may sustain a loss of some or all of your initial investment and therefore you should not invest money that you cannot afford to lose. You should be aware of all the risks associated with foreign exchange trading and seek advice from an independent financial advisor if in doubt. Past performance is not indicative of future results.'
        }
    },

    translate(key) {
        const translation = this.translations[this.currentLang][key];
        return translation || key;
    },

    translatePage() {
        const elements = document.querySelectorAll('[data-i18n]');
        elements.forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.translate(key);
            
            if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                element.placeholder = translation;
            } else if (element.tagName === 'INPUT' && element.type === 'submit') {
                element.value = translation;
            } else {
                element.innerHTML = translation;
            }
        });
    },

    switchLanguage(lang) {
        this.currentLang = lang;
        this.translatePage();
        this.updateActiveButton();
        this.updateLinksForLanguage(lang);
        
        // Save user preference (this will override IP detection for future visits)
        localStorage.setItem('linearity-lang', lang);
        console.log('Language switched to:', lang, '(saved as user preference)');
    },

    updateLinksForLanguage(lang) {
        if (lang === 'en') {
            // English version - update links
            console.log('Updating links for English version');
            
            // Update PDF links (corrected selectors)
            const introLinks = document.querySelectorAll('a[href="intro-it.pdf"]');
            introLinks.forEach(link => {
                link.href = 'intro-en.pdf';
            });
            
            const guideLinks = document.querySelectorAll('a[href="guida-it.pdf"]');
            guideLinks.forEach(link => {
                link.href = 'guida-en.pdf';
            });
            
            // Update Telegram link
            const telegramLinks = document.querySelectorAll('a[href="http://t.me/linearityfx_ita"]');
            telegramLinks.forEach(link => {
                link.href = 'http://t.me/linearityfx_en';
            });
            
        } else {
            // Italian version - restore original links
            console.log('Updating links for Italian version');
            
            // Restore original PDF links (corrected selectors)
            const introLinks = document.querySelectorAll('a[href="intro-en.pdf"]');
            introLinks.forEach(link => {
                link.href = 'intro-it.pdf';
            });
            
            const guideLinks = document.querySelectorAll('a[href="guida-en.pdf"]');
            guideLinks.forEach(link => {
                link.href = 'guida-it.pdf';
            });
            
            // Restore original Telegram link
            const telegramLinks = document.querySelectorAll('a[href="http://t.me/linearityfx_en"]');
            telegramLinks.forEach(link => {
                link.href = 'http://t.me/linearityfx_ita';
            });
        }
    },

    updateActiveButton() {
        const buttons = document.querySelectorAll('.lang-btn');
        buttons.forEach(btn => {
            const btnLang = btn.getAttribute('data-lang');
            if (btnLang === this.currentLang) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    },

    init() {
        // Check for saved language preference first
        const saved = localStorage.getItem('linearity-lang');
        if (saved && this.translations[saved]) {
            console.log('Using saved language preference:', saved);
            this.currentLang = saved;
            this.setupUI();
            return; // Don't run IP detection if user has a saved preference
        }

        // If no saved preference, run IP detection
        this.detectCountryAndSetLanguage();
    },

    async detectCountryAndSetLanguage() {
        try {
            console.log('Running IP geolocation detection...');
            const response = await fetch('https://ipapi.co/json/');
            const data = await response.json();
            
            console.log('IP Detection Result:', data);
            console.log('Country detected:', data.country_code);
            
            // If NOT Italian IP, switch to English
            if (data.country_code && data.country_code.toLowerCase() !== 'it') {
                console.log('Non-Italian IP detected, switching to English');
                this.currentLang = 'en';
            } else {
                console.log('Italian IP detected, keeping Italian');
                this.currentLang = 'it';
            }
            
        } catch (error) {
            console.warn('IP detection failed, defaulting to Italian:', error);
            // Fallback: check browser language
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang && !browserLang.startsWith('it')) {
                console.log('Non-Italian browser language detected, switching to English');
                this.currentLang = 'en';
            } else {
                this.currentLang = 'it';
            }
        }
        
        // Setup UI after language detection
        this.setupUI();
    },

    setupUI() {
        // Set up button listeners
        const buttons = document.querySelectorAll('.lang-btn');
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.getAttribute('data-lang');
                this.switchLanguage(lang);
            });
        });

        // Initial translation, UI update, and link update
        this.translatePage();
        this.updateActiveButton();
        this.updateLinksForLanguage(this.currentLang); // Apply correct links on initialization
        console.log('Language system initialized with:', this.currentLang);
    }
};

// Global function for compatibility
window.switchLanguage = function(lang) {
    window.LinearityI18n.switchLanguage(lang);
};

// Auto-initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    window.LinearityI18n.init();
    console.log('LinearityI18n initialized');
});
